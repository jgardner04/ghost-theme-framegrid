{{!-- FrameGrid Member Content Gate Component --}}
{{!-- Usage: {{> members/content-gate tier="premium"}} Content here {{/members/content-gate}} --}}
{{!-- Tiers: free, paid, workshop, premium --}}

<div x-data="memberGate('{{#if tier}}{{tier}}{{else}}paid{{/if}}')"
     x-init="checkAccess()"
     class="member-content-gate">

  {{!-- Content for authenticated members with access --}}
  <div x-show="showContent"
       x-transition:enter="transition ease-out duration-300"
       x-transition:enter-start="opacity-0 transform translate-y-2"
       x-transition:enter-end="opacity-100 transform translate-y-0"
       class="member-content">
    {{!-- This is where gated content will be inserted --}}
    {{{body}}}
  </div>

  {{!-- Upgrade prompt for authenticated members without access --}}
  <div x-show="showUpgrade"
       x-transition:enter="transition ease-out duration-300"
       x-transition:enter-start="opacity-0 transform translate-y-2"
       x-transition:enter-end="opacity-100 transform translate-y-0"
       class="member-upgrade-prompt">
    <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border border-blue-200 dark:border-blue-700 rounded-lg p-6 text-center">
      <div class="mb-4">
        <svg class="mx-auto h-12 w-12 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 48 48" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v5a3 3 0 006 0v-5m6 0v5a3 3 0 006 0v-5m-13 0a3 3 0 003-3V9a3 3 0 113 3v3a3 3 0 003 3m-6 0v9a3 3 0 01-6 0v-9m6 0h6m-6 0v-3"/>
        </svg>
      </div>

      <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
        {{#if (eq tier "premium")}}
          Premium Content
        {{else if (eq tier "workshop")}}
          Workshop Content
        {{else}}
          Member Content
        {{/if}}
      </h3>

      <p class="text-gray-600 dark:text-gray-300 mb-4">
        {{#if (eq tier "premium")}}
          This exclusive content is available to premium members only. Upgrade your membership to access our most exclusive photography galleries, behind-the-scenes content, and premium tutorials.
        {{else if (eq tier "workshop")}}
          This content is reserved for workshop participants and premium members. Join our photography workshops to unlock this special content and enhance your skills.
        {{else}}
          This content is exclusively available to paid members. Support our work and get unlimited access to our photography galleries and exclusive content.
        {{/if}}
      </p>

      <div class="space-y-3">
        <button @click="requestUpgrade()"
                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
          {{#if (eq tier "premium")}}
            Upgrade to Premium
          {{else if (eq tier "workshop")}}
            Join Workshop Access
          {{else}}
            Become a Member
          {{/if}}
        </button>

        <div class="text-sm text-gray-500 dark:text-gray-400">
          {{#if (eq tier "premium")}}
            Starting at $9.99/month • Cancel anytime
          {{else if (eq tier "workshop")}}
            Workshop access includes premium benefits
          {{else}}
            Starting at $4.99/month • Cancel anytime
          {{/if}}
        </div>
      </div>
    </div>
  </div>

  {{!-- Sign-in prompt for non-authenticated visitors --}}
  <div x-show="!showContent && !showUpgrade"
       x-transition:enter="transition ease-out duration-300"
       x-transition:enter-start="opacity-0 transform translate-y-2"
       x-transition:enter-end="opacity-100 transform translate-y-0"
       class="member-signin-prompt">
    <div class="bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6 text-center">
      <div class="mb-4">
        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 48 48" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c0-1.657 1.343-3 3-3s3 1.343 3 3-1.343 3-3 3-3-1.343-3-3zm0 0v8m0 0c0 1.11.89 2 2 2h2m-2-2v4m8-6V9a3 3 0 00-6 0v2m0 8c0 1.11.89 2 2 2h2m-2-2v4"/>
        </svg>
      </div>

      <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
        Member-Only Content
      </h3>

      <p class="text-gray-600 dark:text-gray-300 mb-4">
        This content is exclusively available to our community members. Sign in to your account or create a new one to access our photography galleries and exclusive content.
      </p>

      <div class="space-y-3 sm:space-y-0 sm:space-x-3 sm:flex sm:justify-center">
        <button @click="$dispatch('open-signin')"
                class="w-full sm:w-auto inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-accent-color hover:bg-accent-color/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-color">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
          </svg>
          Sign In
        </button>

        <button @click="$dispatch('open-signup')"
                class="w-full sm:w-auto inline-flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-color">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
          </svg>
          Create Account
        </button>
      </div>

      <div class="mt-4 text-sm text-gray-500 dark:text-gray-400">
        {{#if (eq tier "free")}}
          Free membership • No credit card required
        {{else}}
          Join thousands of photography enthusiasts
        {{/if}}
      </div>
    </div>
  </div>

  {{!-- Teaser/Preview content for non-members (optional) --}}
  {{#if teaser}}
    <div x-show="!showContent" class="member-content-teaser mt-4">
      <div class="relative">
        <div class="prose dark:prose-invert max-w-none">
          {{{teaser}}}
        </div>
        <div class="absolute inset-0 bg-gradient-to-t from-white dark:from-gray-900 via-transparent to-transparent pointer-events-none"></div>
      </div>
    </div>
  {{/if}}
</div>

{{!-- Event listeners for member auth modal integration --}}
<script>
document.addEventListener('alpine:init', () => {
  // Listen for sign-in/sign-up events from content gates
  document.addEventListener('open-signin', () => {
    const memberAuth = document.querySelector('[x-data*="memberAuth"]');
    if (memberAuth && memberAuth.__x) {
      memberAuth.__x.$data.openSignIn();
    } else {
      // Fallback: trigger Ghost portal
      if (window.ghost && window.ghost.portal) {
        window.ghost.portal.open('signin');
      } else {
        window.location.hash = '#/portal/signin';
      }
    }
  });

  document.addEventListener('open-signup', () => {
    const memberAuth = document.querySelector('[x-data*="memberAuth"]');
    if (memberAuth && memberAuth.__x) {
      memberAuth.__x.$data.openSignUp();
    } else {
      // Fallback: trigger Ghost portal
      if (window.ghost && window.ghost.portal) {
        window.ghost.portal.open('signup');
      } else {
        window.location.hash = '#/portal/signup';
      }
    }
  });
});
</script>
