{{!-- Site header with navigation --}}
<div class="header-container" x-data="memberAuth()">
    {{!-- Logo/Site title --}}
    <div class="site-logo">
        {{#if @site.logo}}
            <a href="{{@site.url}}" aria-label="{{@site.title}} home">
                <img src="{{@site.logo}}" alt="{{@site.title}}" class="logo-image">
            </a>
        {{else}}
            <a href="{{@site.url}}" class="site-title">{{@site.title}}</a>
        {{/if}}
    </div>

    {{!-- Navigation menu --}}
    <nav class="site-nav" role="navigation" aria-label="Main navigation">
        {{!-- Mobile menu toggle button --}}
        <button
            class="menu-toggle md:hidden"
            x-data="{ open: false }"
            @click="open = !open"
            :aria-expanded="open"
            aria-controls="mobile-menu"
            aria-label="Toggle menu"
        >
            <span class="hamburger-line" :class="{ 'rotate-45 translate-y-1': open }"></span>
            <span class="hamburger-line" :class="{ 'opacity-0': open }"></span>
            <span class="hamburger-line" :class="{ '-rotate-45 -translate-y-1': open }"></span>
        </button>

        {{!-- Desktop navigation --}}
        <ul class="nav-menu hidden md:flex">
            <li class="nav-item">
                <a href="{{@site.url}}" class="nav-link {{#is "home"}}current{{/is}}">Home</a>
            </li>
            {{#if @site.navigation}}
                {{#foreach @site.navigation}}
                    <li class="nav-item">
                        <a href="{{url}}" class="nav-link {{#if current}}current{{/if}}">{{label}}</a>
                    </li>
                {{/foreach}}
            {{/if}}
            <li class="nav-item">
                <a href="/portfolio/" class="nav-link">Portfolio</a>
            </li>
            <li class="nav-item">
                <a href="/locations/" class="nav-link">Locations</a>
            </li>
            {{!-- Enhanced Members integration --}}
            {{#unless @member}}
                <li class="nav-item">
                    <button @click="openSignIn()" class="nav-link btn-signin" data-portal="signin">
                        Sign In
                    </button>
                </li>
            {{else}}
                <li class="nav-item member-nav-item">
                    <div class="member-dropdown" x-data="{ open: false }" @click.away="open = false">
                        <button @click="open = !open" class="nav-link member-account-btn flex items-center space-x-2" :aria-expanded="open">
                            {{#if @member.avatar}}
                                <img src="{{@member.avatar}}" alt="{{@member.name}}" class="w-6 h-6 rounded-full">
                            {{else}}
                                <div class="w-6 h-6 rounded-full bg-accent-color flex items-center justify-center text-white text-xs font-medium">
                                    {{substr @member.name 0 1}}
                                </div>
                            {{/if}}
                            <span>{{@member.name}}</span>
                            <svg class="w-4 h-4 transition-transform" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>

                        <div x-show="open"
                             x-transition:enter="transition ease-out duration-200"
                             x-transition:enter-start="opacity-0 transform scale-95"
                             x-transition:enter-end="opacity-100 transform scale-100"
                             x-transition:leave="transition ease-in duration-150"
                             x-transition:leave-start="opacity-100 transform scale-100"
                             x-transition:leave-end="opacity-0 transform scale-95"
                             class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 z-50">
                            <div class="py-1">
                                <button @click="openAccount(); open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                                    Account Settings
                                </button>
                                {{#if @member.paid}}
                                    <a href="#/portal/account/plans" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                                        Subscription
                                    </a>
                                {{else}}
                                    <button @click="requestUpgrade(); open = false" class="block w-full text-left px-4 py-2 text-sm text-accent-color hover:bg-gray-100 dark:hover:bg-gray-700">
                                        Upgrade Membership
                                    </button>
                                {{/if}}
                                <hr class="my-1 border-gray-200 dark:border-gray-700">
                                <button @click="signOut(); open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                                    Sign Out
                                </button>
                            </div>
                        </div>
                    </div>
                </li>
            {{/unless}}
        </ul>

        {{!-- Mobile navigation menu --}}
        <div
            class="mobile-menu md:hidden"
            id="mobile-menu"
            x-data="{ open: false }"
            x-show="open"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 transform scale-95"
            x-transition:enter-end="opacity-100 transform scale-100"
            x-transition:leave="transition ease-in duration-150"
            x-transition:leave-start="opacity-100 transform scale-100"
            x-transition:leave-end="opacity-0 transform scale-95"
            @click.away="open = false"
            @keydown.escape.window="open = false"
        >
            <ul class="mobile-nav-menu">
                <li class="mobile-nav-item">
                    <a href="{{@site.url}}" class="mobile-nav-link {{#is "home"}}current{{/is}}">Home</a>
                </li>
                {{#if @site.navigation}}
                    {{#foreach @site.navigation}}
                        <li class="mobile-nav-item">
                            <a href="{{url}}" class="mobile-nav-link {{#if current}}current{{/if}}">{{label}}</a>
                        </li>
                    {{/foreach}}
                {{/if}}
                <li class="mobile-nav-item">
                    <a href="/portfolio/" class="mobile-nav-link">Portfolio</a>
                </li>
                <li class="mobile-nav-item">
                    <a href="/locations/" class="mobile-nav-link">Locations</a>
                </li>
                {{#unless @member}}
                    <li class="mobile-nav-item">
                        <button @click="openSignIn()" class="mobile-nav-link btn-signin w-full text-left" data-portal="signin">
                            Sign In
                        </button>
                    </li>
                {{else}}
                    <li class="mobile-nav-item">
                        <div class="mobile-member-info px-4 py-2 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex items-center space-x-3">
                                {{#if @member.avatar}}
                                    <img src="{{@member.avatar}}" alt="{{@member.name}}" class="w-8 h-8 rounded-full">
                                {{else}}
                                    <div class="w-8 h-8 rounded-full bg-accent-color flex items-center justify-center text-white text-sm font-medium">
                                        {{substr @member.name 0 1}}
                                    </div>
                                {{/if}}
                                <div>
                                    <div class="text-sm font-medium text-gray-900 dark:text-white">{{@member.name}}</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">{{@member.email}}</div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="mobile-nav-item">
                        <button @click="openAccount()" class="mobile-nav-link w-full text-left">
                            Account Settings
                        </button>
                    </li>
                    {{#if @member.paid}}
                        <li class="mobile-nav-item">
                            <a href="#/portal/account/plans" class="mobile-nav-link">
                                Subscription
                            </a>
                        </li>
                    {{else}}
                        <li class="mobile-nav-item">
                            <button @click="requestUpgrade()" class="mobile-nav-link w-full text-left text-accent-color">
                                Upgrade Membership
                            </button>
                        </li>
                    {{/if}}
                    <li class="mobile-nav-item">
                        <button @click="signOut()" class="mobile-nav-link w-full text-left">
                            Sign Out
                        </button>
                    </li>
                {{/unless}}
            </ul>
        </div>
    </nav>

    {{!-- Include Member Authentication Modal --}}
    {{> members/auth-modal}}
</div>
